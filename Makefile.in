# This file is (c) 1998 Ted Faber (faber@lunabase.org) see COPYRIGHT
# for the full copyright and limitations of liabilities.

prefix = @prefix@
exec_prefix = @exec_prefix@

# By default these are relative to PREFIX.  You can override them on the 
# command line

#BINDIR = $(PREFIX)/bin
#DEFINESDIR = $(PREFIX)/share/grap
#MANDIR = $(PREFIX)/man/man1

BINDIR = @bindir@
DEFINESDIR = @datadir@/grap
MANDIR = @mandir@/man1

INSTALL=@INSTALL@
INSTALL_PROGRAM=@INSTALL_PROGRAM@
INSTALL_DATA=@INSTALL_DATA@
RM=rm
RMDIR=rmdir
MKDIR=mkdir
LEX=@LEX@
YACC=@YACC@
CXX=@CXX@

CXXFLAGS += -Wall @DEFS@ -DDEFINES=\"$(DEFINESDIR)/grap.defines\" 

OBJS=grap.o grap_lex.o grap_draw.o grap_pic.o

all:	grap

.y.cc:
	$(YACC) -d $<
	mv y.tab.c $@

.l.cc:
	$(LEX) -o$@ $<

grap:	$(OBJS)
	$(CXX) $(CXXFLAGS) $(LDFLAGS) $(OBJS) $(LDLIBS) -o grap

y.tab.h:	grap.y
grap.cc:	grap.y
grap_lex.cc:	grap_lex.l y.tab.h

grap.o:		grap.cc grap.h grap_data.h grap_draw.h grap_pic.h
grap_lex.o:	grap_lex.cc grap.h y.tab.h grap_data.h grap_draw.h grap_pic.h
grap_draw.o:	grap_draw.cc grap.h grap_data.h grap_draw.h grap_pic.h
grap_pic.o:	grap_pic.cc grap_pic.h grap.h grap_data.h grap_draw.h

y.output:	grap.y
	$(YACC) -v $<

grap.an:	grap.doc
	perl -pe "s#DEFINES#$(DEFINESDIR)/grap.defines#g; s#EXAMPLES#$(DEFINESDIR)/examples#g;" < grap.doc | groff -Tascii -mdoc | rman -f roff > grap.an

grap.1:	grap.doc grap.an
	if [ `uname` = 'FreeBSD' ]; then \
		perl -pe "s#DEFINES#$(DEFINESDIR)/grap.defines#g; s#EXAMPLES#$(DEFINESDIR)/examples#g;" < grap.doc > grap.1 ;\
	else \
		mv grap.an grap.1; fi

dist:	
	make clean
	make grap.an
	cd .. && tar cf - grap | (cd /tmp && tar xf -)
	rm /tmp/grap/configure.in /tmp/grap/Makefile /tmp/grap/examples/Makefile
	rm /tmp/grap/examples/Makefile.local /tmp/grap/examples/color_example.ms
	rm /tmp/grap/examples/.html* /tmp/grap/examples/.cvsignore
	rm -rf /tmp/grap/CVS /tmp/grap/examples/CVS
	cd /tmp && tar czf grap.tgz grap
	mv /tmp/grap.tgz . && rm -rf /tmp/grap

clean:
	rm -f grap $(OBJS) grap_lex.cc grap.cc  *.o y.tab.h grap.1 config.* grap.tgz

install:	grap grap.defines grap.1
	strip grap
	$(INSTALL) -d $(BINDIR)
	$(INSTALL) -d $(MANDIR)
	$(INSTALL) -d $(DEFINESDIR)/examples
	$(INSTALL_PROGRAM) grap $(BINDIR)
	$(INSTALL_DATA) grap.1 $(MANDIR)
	$(INSTALL_DATA) grap.defines $(DEFINESDIR)
	$(INSTALL_DATA) README $(DEFINESDIR)
	$(INSTALL_DATA) CHANGES $(DEFINESDIR)
	$(INSTALL_DATA) COPYRIGHT $(DEFINESDIR)
	$(INSTALL_DATA) examples/*.d examples/*.ms examples/Makefile $(DEFINESDIR)/examples

deinstall:
	$(RM) $(BINDIR)/grap
	$(RM) $(MANDIR)/grap.1
	$(RM) $(DEFINESDIR)/grap.defines
	$(RM) $(DEFINESDIR)/examples/*.d $(DEFINESDIR)/examples/*.ms $(DEFINESDIR)/examples/Makefile
	$(RMDIR) $(DEFINESDIR)/examples
	$(RMDIR) $(DEFINESDIR)
